/*
Copyright (c) 2012, comScore Inc. All rights reserved.
version: 5.0.3
*/
var _halt=false;
var _reg = /^http(s)?\:\/\/www\.windowsphone\.com/i.test(document.referrer);
if(_reg){
	_halt = true;
}
function _set_SessionCookie(n, f){
  var c = n+'=' + f  	    	
  				+ '; path=/'
   			 	+ '; domain=.windowsphone.com';
	document.cookie = c;	
}

var allLinks = document.getElementsByTagName("a");
 for (var i = 0, n = allLinks.length; i < n; i++) {
	if(/(https:\/\/www\.windowsphone\.com\/(en-(us|gb)|de-de|fr-fr|)\/(my|family))|signin/i.test(allLinks[i].href)){
		if(allLinks[i].addEventListener){
			allLinks[i].addEventListener('click',function(event){
				_set_SessionCookie("graceIncr", 1);
				},false);
		}else{
			hrefURL = allLinks[i].href;
			allLinks[i].attachEvent('onclick',function(){ 
				_set_SessionCookie("graceIncr", 1);
				});
		}
 	}
 }

_set_SessionCookie("graceIncr", 0);

COMSCORE.SiteRecruit.Broker.config = {
	version: "5.0.3",
	//TODO:Karl extend cookie enhancements to ie userdata
		testMode: false,
	
	// cookie settings
	cookie:{
		name: 'msresearch',
		path: '/',
		domain:  '.windowsphone.com' ,
		duration: 90,
		rapidDuration: 0,
		expireDate: ''
	},
	thirdPartyOptOutCookieEnabled : true,
	thirdPartyOptOutCookie1:{
		name: 'ar_p127227702',
		path: '',
		domain: '',
		duration: 0,
		rapidDuration: 0,
		expireDate: ''
	},
	thirdPartyOptOutCookie2:{
		name: '' ,
		path: '',
		domain: '',
		duration: 0,
		rapidDuration: 0,
		expireDate: ''
	},	
	
	
	// optional prefix for pagemapping's pageconfig file
	prefixUrl: "",
	
	//events
	Events: {
		beforeRecruit: function() {
					}
	},
	
		mapping:[
	// m=regex match, c=page config file (prefixed with configUrl), f=frequency
	{m: '//[\\w\\.-]+/en-us', c: 'inv_c_p127227702-US.js', f: 0.017, p: 0, halt: _halt 	}
	,{m: '//[\\w\\.-]+/en-gb', c: 'inv_c_p127227702-GB.js', f: 0.021, p: 0, halt: _halt 	}	
	,{m: '//[\\w\\.-]+/fr-fr', c: 'inv_c_p127227702-FR.js', f: 0.026, p: 0, halt: _halt 	}
	,{m: '//[\\w\\.-]+/de-de', c: 'inv_c_p127227702-DE.js', f: 0.023, p: 0, halt: _halt 	}
	,{m: '//[\\w\\.-]+/en-us/cmpn/nokia-lumia-928', c: 'inv_c_p127227702-US-2157.js', f: 0, p: 1, halt: true 	}
	,{m: '//[\\w\\.-]+/en-us/cmpn/start-screen-celebration', c: 'inv_c_p127227702-US-2158.js', f: 0, p: 1, halt: true 	}
	,{m: '//[\\w\\.-]+/en-us/cmpn/switch', c: 'inv_c_p127227702-US-2159.js', f: 0, p: 1, halt: true 	}
	
]
};
COMSCORE.SiteRecruit.Broker.run();